<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>Go wasm</title>
  <link rel="icon" type="image/jpg" href="favicon.jpg">
</head>

<body>

  <div style="width:1200px; float:right">
    <h2>Records</h2>
    <div id="records"></div>
  </div>
  <div style="width:200px; float: left">
    <h2>Refinements</h2>
    <div id="refinements"></div>
  </div>
  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
  <script src="facet-engine.js"></script>

  <script>
    createRecords(["record 1", "record 2"])
    let jsonData = [
      {
        "id": "record 1",
        "measurements": [
          {
            "measurementName": "area",
            "metrics": {
              "metricName": "cube",
              "measurements": {
                "side": "10"
              }
            }
          }
        ]
      },
      {
        "id": "record 2",
        "measurements": [
          {
            "measurementName": "area",
            "metrics": {
              "metricName": "cube",
              "measurements": {
                "side": "20"
              }
            }
          }
        ]
      }
    ]

    facetEngineLoad('facet-engine.wasm', function () {
      let config = {
        arrayDotNotation: "measurements",
        nameFieldDotNotation: "measurementName",
        nameMetaDotNotation: "metrics.metricName",
        valueMapDotNotation: "metrics.measurements",
      }
      // this will call back to facetEngineCallbackFacets(stringifiedFacets)
      facetEngineInitializeObjects(JSON.stringify(config), JSON.stringify(jsonData))
      // facetEngineAddFilter("area (cube)", "side", false, 10.0, false, 22.0)
      // facetEngineQuery()
    })

    function facetEngineCallbackFacets(facetGroupsJson) {
      facetGroups = JSON.parse(facetGroupsJson)
      console.dir(facetGroups)
      let html = ''
      Object.keys(facetGroups).forEach(function (key1) {
        let facetGroup = facetGroups[key1];
        html += '<div class="group"><h3>' + key1 + '</h3></div>'
        Object.keys(facetGroup.facets).forEach(function (key2) {
          let facet = facetGroup.facets[key2]
          html += '<div class="facet"><h4>' + key2 + '</h4></div>'
          console.log(facet.values);
          facet.values.forEach((value) => {
            html += '<div class="facet-value">' + value + '</div>'
          })
        })
      });

      $("#refinements").append(html)

    }

    function facetEngineCallbackRecords(idsJson) {
      ids = JSON.parse(idsJson)
      createRecords(ids)
    }

    function createRecords(ids) {
      let html = ''
      ids.forEach((id) => {
        html += '<div>' + id + '</div>';
      })
      $("#records").append(html)
    }

  </script>
</body>

</html>