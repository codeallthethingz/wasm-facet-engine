<!doctype html>
<!--
Copyright 2018 The Go Authors. All rights reserved.
Use of this source code is governed by a BSD-style
license that can be found in the LICENSE file.
-->
<html>

<head>
  <meta charset="utf-8">
  <title>Go wasm</title>
  <link rel="icon" type="image/jpg" href="favicon.jpg">
</head>

<body>
  <!--
	Add the following polyfill for Microsoft Edge 17/18 support:
	<script src="https://cdn.jsdelivr.net/npm/text-encoding@0.7.0/lib/encoding.min.js"></script>
	(see https://caniuse.com/#feat=textencoder)
	-->
  <script src="facet-engine.js"></script>

  <script>
    let jsonData = [
      {
        "id": "record 1",
        "measurements": [
          {
            "measurementName": "area",
            "metrics": {
              "metricName": "cube",
              "measurements": {
                "side": "10"
              }
            }
          }
        ]
      },
      {
        "id": "record 2",
        "measurements": [
          {
            "measurementName": "area",
            "metrics": {
              "metricName": "cube",
              "measurements": {
                "side": "20"
              }
            }
          }
        ]
      }
    ]
    
    facetEngineLoad('facet-engine.wasm', function () {
      let config = {
        arrayDotNotation: "measurements",
        nameFieldDotNotation: "measurementName",
        nameMetaDotNotation: "metrics.metricName",
        valueMapDotNotation: "metrics.measurements",
      }
      // this will call back to facetEngineCallbackFacets(stringifiedFacets)
      facetEngineInitializeObjects(JSON.stringify(config), JSON.stringify(jsonData))
      facetEngineAddFilter("area (cube)", "side", true, 10.0, false, 22.0)
      facetEngineQuery()
    })

    function facetEngineCallbackFacets(facetsJson) {
      console.log('got facet callback: ' + facetsJson)
    }

    function facetEngineCallbackRecords(idsJson) {
      console.log('got records callback: ' + idsJson)
    }

  </script>
</body>

</html>